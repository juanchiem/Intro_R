{
  "hash": "377d492cf3e62b6d25648d10f20c8439",
  "result": {
    "markdown": "\n\n\n# Anova \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-2_77c04431dcc4c22e15bd35fa7ed8b2a6'}\n\n```{.r .cell-code}\n# install.packages(\"multcompView\") # solo una vez y no hace falta cargarlo\n\npacman::p_load(\n  tidyverse,\n  skimr,       # exploracion numerica de los datos\n  performance, # evaluar performance de los modelos\n  emmeans,     # medias estimadas por el modelo  \n  multcomp     # comparar las medias entre si - tukey\n  )\n```\n:::\n\n\n## Un solo factor \n\nExperimento DCA: dataset `PlantGrowth`\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-3_6f6ec31e76a2d914d1411a3f1fb30385'}\n\n```{.r .cell-code}\npg <- PlantGrowth # simplificamos el nombre del dataset\npg\n```\n:::\n\n\n`PlantGrowth {datasets}` \n\n>  Results from an experiment to compare yields (as measured by dried weight of plants) obtained under a control and two different treatment conditions.\n\n1- Exploración numérica \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-4_e31dff88fa9e050e8e6bc27741cf73b8'}\n\n```{.r .cell-code}\nstr(pg) # tipo de variables\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-5_811229c382c8c83ca58c7182751ccf0e'}\n\n```{.r .cell-code}\npg %>%   \n  group_by(group) %>%\n  skimr::skim() # exploración numérica\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-6_a2ab6f7d2105781e20b8d57268d3bd5a'}\n\n```{.r .cell-code}\npg %>% \n  group_by(group) %>% \n  summarise(\n    n = sum(!is.na(weight)), \n    mean = mean(weight),\n    sd = sd(weight))\n```\n:::\n\n\n2- Exploración visual \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-7_a26cabfa6c506fd6f233bc62f2195ee7'}\n\n```{.r .cell-code}\npg %>% \n  ggplot()+ \n  aes(x=group, y=weight) + \n  geom_boxplot(width=0.2)+\n  geom_jitter(alpha=0.2, width=0.2)\n```\n:::\n\n\n3- Ajuste del modelo lineal \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-8_774bd23fe0394e9166d36739972c08eb'}\n\n```{.r .cell-code}\nmod1 <- lm(weight ~ group, data = pg)  \n```\n:::\n\n\n\n$$y_{ij} = \\mu + \\alpha_i + e_{ij}; \\:\\:i = 1,..., k; \\:j = 1,..., n$$\n$$N \\sim (\\sigma^2, 0)$$\n\n5- Diagnósticos \n\n¿Las varianzas (entre niveles del factor) son homogéneas? \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-9_63e1b9e0c69b0ec318ade1cd6ef15127'}\n\n```{.r .cell-code}\ncheck_heteroscedasticity(mod1) %>% plot\n# plot(mod1, which = 1)\n# car::leveneTest(mod1)\n```\n:::\n\n\n¿Los residuos se distribuyen normales?\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-10_1c5b3af1a0748857d2f56015cabbcf5a'}\n\n```{.r .cell-code}\ncheck_normality(mod1) %>% plot\n# plot(mod1, which = 2)\n# shapiro.test(rstandard(mod1))\n```\n:::\n\n\n\n6-  Estadisticas  \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-11_643735e83784bdcaa0df082a25b0ad35'}\n\n```{.r .cell-code}\nanova(mod1)# caso balanceado\nsummary(mod1)\n# car::Anova(mod1)# caso desbalanceado\n```\n:::\n\n\n7- Comparaciones múltiples  {-}\n\nPaquete [emmeans](https://cran.r-project.org/web/packages/emmeans/vignettes/vignette-topics.html)\n\nMedias e intervalos de confianza estimadas por el modelo\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-12_641d551a201d0a43483864500a2b4e5b'}\n\n```{.r .cell-code}\nem <- emmeans(mod1, ~ group, type=\"response\")\nem # %>% knitr::kable()\nclass(em)\n```\n:::\n\n\nTest de Tukey \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-13_c9e80d01a3f8ae434cb9e0b03110e6c2'}\n\n```{.r .cell-code}\nres  <- cld(em, \n            Letters = letters, \n            reverse = TRUE, \n            alpha = .05)  \nres\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-14_d596b659160aadfda8302ce605b0018b'}\n\n```{.r .cell-code}\n?pwpm\npwpm(em, adjust = \"none\")\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-15_eed70ae81307fae676d974a7681cb268'}\n\n```{.r .cell-code}\nres <- res %>% \n  mutate(letras = str_squish(.group), \n         weight = emmean)\n```\n:::\n\n\n8- Grafico final\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-16_4b3ac36c2ffec4967c79e075db6a7077'}\n\n```{.r .cell-code}\nres %>%  \n  ggplot() +\n  aes(x=group, y=weight)+\n  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL))+\n  labs(x = \"Tratamiento\", y = \"Peso (g)\")+  \n  geom_text(aes(label = letras), angle=90, vjust=-1)+\n  geom_jitter(data = pg, width = .1, alpha=.5) +\n  theme_bw()\n```\n:::\n\n\nComparación de medias de los trat vs testigo (Dunnet)\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-17_5e35fdb196e033dcfa6085dc3bee3cd2'}\n\n```{.r .cell-code}\ncontrast(em, \"trt.vs.ctrl1\")\n```\n:::\n\n\n:::{#box1 .blue-box}\n\nComparación de medias por LSD\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-18_c5a47a1ab89ed2acc8628b283d123409'}\n\n```{.r .cell-code}\nlibrary(agricolae)\n\nres_lsd <- LSD.test(y = mod1, \n                    trt = \"group\",\n                    group = T, \n                    console = T)\nres_lsd\nbar.group(x = res_lsd$groups, \n          ylim=c(0, 7),\n          # main=\"Prueba de comparación de medias por medio del método LSD\",\n          # xlab=\"Tipo de Mezcla\",\n          # ylab=\"Rendimiento del proceso\",\n          col=\"steelblue\")\n```\n:::\n\n::: \n\n\n## Dos factores \n\nDatos `festuca`\n\n> Las plantas tienen un pH del suelo óptimo para el crecimiento, y esto varía entre especies. En consecuencia, esperaríamos que si cultivamos dos plantas en competencia entre sí a diferentes valores de pH, el efecto de la competencia podría variar según el pH del suelo. En un estudio reciente se investigó el crecimiento de la gramínea Festuca ovina (Festuca de oveja) en competencia con el brezo Calluna vulgaris (Ling) en suelos con diferente pH. Calluna está bien adaptada para crecer en suelos muy ácidos, como en los pantanos de arena. Festuca crece en suelos con un rango mucho más amplio de pH. Podríamos suponer que Calluna será un mejor competidor de Festuca en suelos muy ácidos que en suelos moderadamente ácidos.\nPara probar esta hipótesis, se diseñó un experimento en el que se cultivaron plántulas de Festuca en macetas en todas las combinaciones de dos niveles de dos tipos diferentes de tratamiento\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-19_9c7318ef6591816db04180cd7edacc30'}\n\n```{.r .cell-code}\nfestuca <- structure(list(weight = c(2.76, 2.39, 2.54, 3.11, 2.49, 4.1, \n2.72, 2.28, 3.43, 3.31, 3.21, 4.1, 3.04, 4.13, 5.21, 5.92, 7.31, \n6.1, 5.25, 8.45), ph = c(\"pH3.5\", \"pH3.5\", \"pH3.5\", \"pH3.5\", \n\"pH3.5\", \"pH3.5\", \"pH3.5\", \"pH3.5\", \"pH3.5\", \"pH3.5\", \"pH5.5\", \n\"pH5.5\", \"pH5.5\", \"pH5.5\", \"pH5.5\", \"pH5.5\", \"pH5.5\", \"pH5.5\", \n\"pH5.5\", \"pH5.5\"), Calluna = c(\"Present\", \"Present\", \"Present\", \n\"Present\", \"Present\", \"Absent\", \"Absent\", \"Absent\", \"Absent\", \n\"Absent\", \"Present\", \"Present\", \"Present\", \"Present\", \"Present\", \n\"Absent\", \"Absent\", \"Absent\", \"Absent\", \"Absent\")), row.names = c(NA, \n20L), class = \"data.frame\")\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-20_215e11b89b575e648aebfc8fc264ffb4'}\n\n```{.r .cell-code}\n# festuca <- rio::import(\"https://docs.google.com/spreadsheets/d/1c_FXVNkkj4LD8hVUForaaI24UhRauh_tWsy7sFRSM2k/edit#gid=477107180\")\n\nfestuca <- rio::import(\"data/datos_curso.xls\", sheet =\"festuca\")\n```\n:::\n\n\n- Exploracion  {-}\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-21_d964b5f70407dc3edf241fde4a57cd0a'}\n\n```{.r .cell-code}\nfestuca %>% \n  janitor::tabyl(ph, Calluna)\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-22_348dc7e008fc305774fbf51809f0c4ef'}\n\n```{.r .cell-code}\nfestuca %>% skim()\nfestuca <- festuca %>% mutate_if(is.character, as.factor)\nfestuca %>% skim()\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-23_05df573d92825e366baf6d84abff7ee8'}\n\n```{.r .cell-code}\ndodge <- position_dodge(width=0.5)\n\nfestuca %>% \n  ggplot()  +\n  aes(x = ph, y = weight, fill = Calluna) + \n  geom_boxplot(position = dodge, alpha=.5) +\n  geom_point(position = dodge)\n  # geom_line(aes(group=supp), stat = \"summary\", fun=mean) \n```\n:::\n\n\n- Ajuste  {-} \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-24_6a34c37be2429fdf4aebbb43b4f10247'}\n\n```{.r .cell-code}\nfest_fit <- lm(weight ~ ph * Calluna, data = festuca)\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-25_08f614a2a37c31d1ebd6d8dd1f6fb05f'}\n\n```{.r .cell-code}\nfest_fit_log\n```\n:::\n\n\n- Diagnósticos  {-}\n\n¿Las varianzas (entre niveles del factor) son homogéneas? \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-26_df1d5d4294aaa4ec98de9d95c7103422'}\n\n```{.r .cell-code}\ncheck_heteroscedasticity(fest_fit) # %>% plot\n```\n:::\n\n\n¿Los residuos se distribuyen normales?\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-27_01cc0be5361554ab84b0a40ca565db75'}\n\n```{.r .cell-code}\ncheck_normality(fest_fit) # %>% plot\n```\n:::\n\n\n- Transformación  {-} \n\n:::{#box1 .blue-box}\n\n**Transformación potencia óptima de boxcox**\n\nEsta transformación sólo tiene un parámetro: lambda, graficado en el eje x. Si el valor de lambda es igual a cero, se lleva a cabo la transformación con el logaritmo natural, y si dicho valor es distinto a cero la transformación es potencial. \n\n![](fig/boxcox.png){width=300px} \n\n![](fig/boxcox_1.png){width=350px}![](fig/boxcox_02.png){width=350px}\n\nSi el parámetro lambda es igual a uno, no hace falta transformar la variable respuesta. Si el intervalo (líneas punteadas verticales) no contiene a 0 ni a 1, hay que transformar la variable elevando a la potencia del valor de lamba incluido en el intervalo. \n\nLa utilización de la transformación Box-Cox requiere que todos los valores de la serie de entrada sean positivos y distintos a cero.\nPor ello es adicionada una constante a la variable original (0.5, por ej.).\n\nEn el caso que la transformacion optima sea lambda = 0.2, el modelo resultaría: \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-28_e4f592270475e97a3fb5b070211e4a5a'}\n\n```{.r .cell-code}\nlm((y+0.5)^0.2 ~ trt ...)\n```\n:::\n\n:::\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-29_b1c4f956c67f2285734d5770052ec968'}\n\n```{.r .cell-code}\nboxcox(fest_fit)\n```\n:::\n\n\n> Se sugiere transformacion `log` ya que el lambda optimo contiene al 0\n\n- Reajuste de modelo  {-}\n\n...con variable respuesta transformada\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-30_61e387d415f210d637e671bbc977bf26'}\n\n```{.r .cell-code}\nfest_fit_log <- lm(log(weight) ~  Calluna * ph, data = festuca)\n```\n:::\n\n\nNuevamente se diagnostica la estabilizacion de la varianza\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-31_cf0ef5ff72079d20876255432d42b297'}\n\n```{.r .cell-code}\ncheck_heteroscedasticity(fest_fit_log) %>% plot\n```\n:::\n\n\n- Estadisticas del modelo  {-}\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-32_fed5f3c4c90ac3309e57661f4b72eb06'}\n\n```{.r .cell-code}\nanova(fest_fit_log)\n```\n:::\n\n\n\n- Medias estimadas por el modelo  {-} \n\n... y su dispersion\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-33_c2eee4d5b90d92326eab8dcb313f0970'}\n\n```{.r .cell-code}\nfest_em <- emmeans(fest_fit_log, ~ Calluna | ph, type = \"response\")\nfest_em\n```\n:::\n\n\n- Comparaciones multiples  {-}\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-34_c791c1fcc20647415c981ec1dd7ae2ce'}\n\n```{.r .cell-code}\nres_festuca <- cld(fest_em, alpha=.05, Letters=letters)\nres_festuca\n```\n:::\n\n\n- Grafico final  {-}\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-35_65922ee92149678edc7760f01eb6ffae'}\n\n```{.r .cell-code}\nres_festuca <- res_festuca %>% \n  mutate(letras=str_squish(.group), \n         weight=response)  \n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-36_f5596d695d4ad58f31b3d171bbbdbe60'}\n\n```{.r .cell-code}\nres_festuca %>%  \n  ggplot() +\n  aes(x=ph, y=weight, col=Calluna)+\n  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL), \n                  position = dodge)+\n  labs(x = \"\", y = \"Weight (g)\")+  \n  geom_text(vjust=-1, angle=90, aes(label = letras), position = dodge)+\n  # geom_jitter(data = festuca, alpha=0.2, position = position_dodge(width=0.5)) +\n  theme_bw()\n```\n:::\n\n\n<b>Lexturas recomendadas</b> \n\n- [Analysis and Interpretation of Interactions in Agricultural Research](https://dl.sciencesocieties.org/publications/aj/pdfs/107/2/748)\n\n- [Analysis of Combined Experiments Revisited](https://dl.sciencesocieties.org/publications/aj/pdfs/107/2/763)\n\n- [Model Syntax in R](http://conjugateprior.org/2013/01/formulae-in-r-anova/)\n\n- [ANOVA: A Short Intro Using R](https://stat.ethz.ch/~meier/teaching/anova/)\n\n- [glmmFAQ](https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html)\n\n- [A brief introduction to mixed effects modelling and multi-model inference in ecology](https://peerj.com/articles/4794/)\n\n- [Data Analysis Examples](https://stats.idre.ucla.edu/other/dae/)\n\n- [Data Analysis and Visualization in R for Ecologists](https://datacarpentry.org/R-ecology-lesson/index.html)\n\n- [RNAseq analysis with R](http://monashbioinformaticsplatform.github.io/RNAseq-DE-analysis-with-R/)\n\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}