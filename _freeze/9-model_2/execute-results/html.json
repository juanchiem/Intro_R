{
  "hash": "e7a093d0f55a46936b7cdccf9d7c988e",
  "result": {
    "markdown": "\n\n\n# Anova\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-2_77c04431dcc4c22e15bd35fa7ed8b2a6'}\n\n```{.r .cell-code}\n# install.packages(\"multcompView\") # solo una vez y no hace falta cargarlo\n\npacman::p_load(\n  tidyverse,\n  skimr,       # exploracion numerica de los datos\n  performance, # evaluar performance de los modelos\n  emmeans,     # medias estimadas por el modelo  \n  multcomp     # comparar las medias entre si - tukey\n  )\n```\n:::\n\n\n## Un solo factor\n\nExperimento DCA: dataset `PlantGrowth`\n\n`PlantGrowth {datasets}`: Results from an experiment to compare yields (as measured by dried weight of plants) obtained under a control and two different treatment conditions.\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-3_6f6ec31e76a2d914d1411a3f1fb30385'}\n\n```{.r .cell-code}\npg <- PlantGrowth # simplificamos el nombre del dataset\npg\n```\n:::\n\n\n* Exploración numérica\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-4_e31dff88fa9e050e8e6bc27741cf73b8'}\n\n```{.r .cell-code}\nstr(pg) # tipo de variables\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-5_811229c382c8c83ca58c7182751ccf0e'}\n\n```{.r .cell-code}\npg %>%   \n  group_by(group) %>%\n  skimr::skim() # exploración numérica\n```\n:::\n\n\n::: {.callout-note icon=\"false\"}\nLas mismas medidas resumen podriamos obtenerlo con dplyr\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-6_0bc6887bf987415685f7ea92472c4079'}\n\n```{.r .cell-code}\npg %>% \n  group_by(group) %>% \n  summarise(\n    n = sum(!is.na(weight)), \n    mean = mean(weight),\n    sd = sd(weight))\n```\n:::\n\n:::\n\n* Exploración visual\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-7_a26cabfa6c506fd6f233bc62f2195ee7'}\n\n```{.r .cell-code}\npg %>% \n  ggplot()+ \n  aes(x=group, y=weight) + \n  geom_boxplot(width=0.2)+\n  geom_jitter(alpha=0.2, width=0.2)\n```\n:::\n\n\n* Ajuste del modelo lineal\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-8_774bd23fe0394e9166d36739972c08eb'}\n\n```{.r .cell-code}\nmod1 <- lm(weight ~ group, data = pg)  \n```\n:::\n\n\n\n$$y_{ij} = \\mu + \\alpha_i + e_{ij}; \\:\\:i = 1,..., k; \\:j = 1,..., n$$ $$N \\sim (\\sigma^2, 0)$$\n\n* Diagnósticos\n\n- ¿Las varianzas (entre niveles del factor) son homogéneas?\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-9_fbafe697f0d85aef387c88b7eb236905'}\n\n```{.r .cell-code}\ncheck_heteroscedasticity(mod1) %>% plot\n```\n:::\n\n\n::: {.callout-note icon=\"false\"}\nMismo con el paquete \"stats\" \n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-10_74f85b45e489c20122de10a93fd8a51c'}\n\n```{.r .cell-code}\n# plot(mod1, which = 1)\n# car::leveneTest(mod1)\n```\n:::\n\n:::\n\n- ¿Los residuos se distribuyen normales?\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-11_37dc97699b3898fd5a989fa3482b671b'}\n\n```{.r .cell-code}\ncheck_normality(mod1) \ncheck_normality(mod1) %>% plot\n```\n:::\n\n\n::: {.callout-note icon=\"false\"}\nMismo con el paquete \"stats\" \n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-12_5b300e620fd93c3253798705e35b03c1'}\n\n```{.r .cell-code}\n# check_normality(mod1) %>% plot\nplot(mod1, which = 2)\nshapiro.test(rstandard(mod1))\n```\n:::\n\n:::\n\n* Estadísticas\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-13_0c0323c95555b4fd41862c7382f21371'}\n\n```{.r .cell-code}\nanova(mod1)# caso balanceado\nsummary(mod1)\n# car::Anova(mod1)# caso desbalanceado\n```\n:::\n\n\n* Estimación de medias y error estándar de cada trat\n\nPaquete [emmeans](https://cran.r-project.org/web/packages/emmeans/vignettes/vignette-topics.html)\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-14_25bf65c4d974a524d6c60807556bb00a'}\n\n```{.r .cell-code}\nem <- emmeans(mod1, ~ group, type=\"response\")\nem # %>% knitr::kable()\nclass(em)\n```\n:::\n\n\n* Comparaciones múltiples\n\nTest de Tukey\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-15_372218406da6d3ce3024d93ec19f71bd'}\n\n```{.r .cell-code}\nres  <- cld(em, \n            Letters = letters, \n            reverse = TRUE, \n            alpha = .05)  \nres\n```\n:::\n\n\n* Gráfico final\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-16_adb6221c0d62f982a8168932e625f7a5'}\n\n```{.r .cell-code}\nplot(em, col=\"grey30\") + \n  theme_bw()\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-17_759ac3c20ca626588ecc7169e88bc68b'}\n\n```{.r .cell-code}\nres %>%  \n  ggplot() +\n  aes(x=group, y=emmean)+\n  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL))+\n  labs(x = \"Tratamiento\", y = \"Peso (g)\")+  \n  # Letras de Tukey\n  geom_text(aes(label = str_squish(.group)), \n            angle=90, vjust=-1)+\n  # Observaciones originales\n  geom_jitter(data = pg, width = .1, alpha=.5,\n              aes(y=weight)) +\n  theme_bw()\n```\n:::\n\n\nComparación de medias de los trat vs testigo (Dunnet)\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-18_d6c6bd6304f8b295086b0d2dcf82f7ad'}\n\n```{.r .cell-code}\ncontrast(em, \"trt.vs.ctrl1\")\n```\n:::\n\n\n::: {.callout-note icon=\"false\"}\n## Xtras\nComparación de medias por LSD\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-19_be252f468276b6166bcb618d9d6855ac'}\n\n```{.r .cell-code}\nlibrary(agricolae)\nres_lsd <- LSD.test(y = mod1, \n                    trt = \"group\",\n                    group = T, \n                    console = T)\nres_lsd\nbar.group(x = res_lsd$groups, \n          ylim=c(0, 7),\n          # main=\"Prueba de comparación de medias por medio del método LSD\",\n          # xlab=\"Tipo de Mezcla\",\n          # ylab=\"Rendimiento del proceso\",\n          col=\"steelblue\")\n```\n:::\n\n:::\n\n## Dos factores\n\n::: {.callout-note icon=\"false\"}\nDatos `festuca`\n\n![](fig_3/festuca.jpg){fig-align=\"center\" width=\"300px\"}\n\nEn un estudio reciente se investigó el crecimiento de la gramínea **Festuca ovina** (Festuca de oveja) en competencia con el brezo **Calluna vulgaris** (Ling) en suelos con diferente pH. Calluna está bien adaptada para crecer en suelos muy ácidos, como en los pantanos de arena. Festuca crece en suelos con un rango mucho más amplio de pH. Podríamos suponer que Calluna será un mejor competidor de Festuca en suelos muy ácidos que en suelos moderadamente ácidos. Para probar esta hipótesis, se diseñó un experimento en el que se cultivaron plantas de Festuca en macetas a dos nivels de pH, con o sin la presencia de calluna como competidora, con 5 repeticiones. \n:::\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-20_8654907e6a2e7e43bb674f57646eee08'}\n\n```{.r .cell-code}\nfestuca <- rio::import(\"https://raw.githubusercontent.com/juanchiem/agro_data/master/festuca.csv\") %>% \n  mutate_if(is.character, as.factor)\n```\n:::\n\n\n-   Exploracion {-}\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-21_9761f2682f1ef33f938686bf74626192'}\n\n```{.r .cell-code}\nxtabs(~ ph+Calluna, festuca)\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-22_6e64e4e3ac61cf1a9d10733d9098ee19'}\n\n```{.r .cell-code}\nfestuca %>% skim()\n```\n:::\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-23_055b15e69ea465e0b14733be2f479d7f'}\n\n```{.r .cell-code}\ndodge <- position_dodge(width=0.5)\n\nfestuca %>% \n  ggplot()  +\n  aes(x = ph, y = weight, col = Calluna) + \n  geom_boxplot(position = dodge, width=.4) +\n  geom_point(position=position_jitterdodge(dodge.width=0.5), \n             width=.05)\n```\n:::\n\n\n-   Ajuste {-}\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-24_234adbbcb1453c25dc12d375f79d450d'}\n\n```{.r .cell-code}\nfit1 <- lm(weight ~ ph * Calluna, data = festuca)\n```\n:::\n\n\n-   Diagnósticos {-}\n\n¿Las varianzas (entre niveles del factor) son homogéneas?\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-25_1ad478f383b30af40afe948b20885502'}\n\n```{.r .cell-code}\ncheck_heteroscedasticity(fit1) # %>% plot\n```\n:::\n\nPara estabilizar las varianzas una opción puede ser la transformación de **Potencia óptima de Box-Cox**\n\n::: {.callout-note icon=\"false\"}\n\n**Transformación potencia óptima de boxcox**\n\nEsta transformación sólo tiene un parámetro: lambda, graficado en el eje x, al cual deberiamos elevar nuestra variable respuesta para estabilizar varianzas. \n\nSi el intervalo de confianza (líneas punteadas verticales) del valor máximo contiene al 1, no deberíamos transformar la variable respuesta:\n\n![](fig_3/boxcox_1.png){width=\"350px\"}\n\nSi el valor de lambda es igual a cero, se lleva a cabo la transformación con el logaritmo natural\n\n![](fig_3/boxcox_2.png){width=\"350px\"}\n\n...Si el intervalo no contiene a 0 ni a 1, hay que transformar la variable elevando a la potencia del valor de lamba incluido en el intervalo.\n\n![](fig_3/boxcox.png){width=\"300px\"}\n\nNoten que si nuestros datos contienen 0´s, el LN nos daria errores, en esos casos es adicionada una constante a la variable original (0.5, por ej.).\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-26_abe1f3905640f7b68f4007011bbd5f2d'}\n\n```{.r .cell-code}\nlm(log(y+0.5) ~ trt ...)\n```\n:::\n\n:::\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-27_a5e228050fbf378c8d61974e79a77c3b'}\n\n```{.r .cell-code}\nboxcox(fit1)\n```\n:::\n\n\n> Se sugiere transformacion `log` ya que el lambda optimo contiene al 0\n\n-   Reajuste de modelo\n\n...con variable respuesta transformada\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-28_962c79c6f019651952ac05eb1fadac89'}\n\n```{.r .cell-code}\nfit2 <- lm(log(weight) ~  Calluna * ph, data = festuca)\n```\n:::\n\n\nNuevamente se diagnostica la estabilización de las varianzas\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-29_330bccf5a390a6d6633ff99a2d3bb413'}\n\n```{.r .cell-code}\ncheck_heteroscedasticity(fit2)\n```\n:::\n\n¿Los residuos se distribuyen normales?\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-30_d61776e588f749d243575d108f77133d'}\n\n```{.r .cell-code}\ncheck_normality(fit2) # %>% plot\n```\n:::\n\n\nAhora si, podríamos avanzar con nuestro modelo.\n\n-   Estadísticas del modelo\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-31_16e5117415c32c0d5f9047bbaf864cf5'}\n\n```{.r .cell-code}\nanova(fit2)\n```\n:::\n\n\n-   Medias y SE estimados por el modelo\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-32_f0d020d94894e1e2af82bc05773b0801'}\n\n```{.r .cell-code}\nfest_em <- emmeans(fit2, ~ Calluna | ph, type = \"response\")\nfest_em\n```\n:::\n\n\n-   Comparaciones múltiples\n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-33_4e8e0339892ad422471b9940348efd7e'}\n\n```{.r .cell-code}\nres_festuca <- cld(fest_em, alpha=.05, Letters=letters)\nres_festuca\n```\n:::\n\n-   Gráfico final \n\n\n::: {.cell hash='9-model_2_cache/html/unnamed-chunk-34_06abe750518f36ed533bf16753535dde'}\n\n```{.r .cell-code}\nres_festuca %>%  \n  ggplot() +\n  aes(x=ph, y=response, col=Calluna)+\n  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL), \n                  position = dodge)+\n  labs(x = \"\", y = \"Weight (g)\")+  \n  geom_text(vjust=-1, angle=90, \n            aes(label = str_squish(.group)), position = dodge)+\n  # geom_jitter(data = festuca, alpha=0.2, position = position_dodge(width=0.5)) +\n  theme_bw()\n```\n:::\n\n\n* Recursos\n\n[Analysis and Interpretation of Interactions in Agricultural Research](https://dl.sciencesocieties.org/publications/aj/pdfs/107/2/748)\n\n[Analysis of Combined Experiments Revisited](https://dl.sciencesocieties.org/publications/aj/pdfs/107/2/763)\n\n[Model Syntax in R](http://conjugateprior.org/2013/01/formulae-in-r-anova/)\n\n[ANOVA: A Short Intro Using R](https://stat.ethz.ch/~meier/teaching/anova/)\n\n[glmmFAQ](https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html)\n\n[A brief introduction to mixed effects modelling and multi-model inference in ecology](https://peerj.com/articles/4794/)\n\n[Data Analysis Examples](https://stats.idre.ucla.edu/other/dae/)\n\n[Data Analysis and Visualization in R for Ecologists](https://datacarpentry.org/R-ecology-lesson/index.html)\n\n[RNAseq analysis with R](http://monashbioinformaticsplatform.github.io/RNAseq-DE-analysis-with-R/)\n\n[regresion_lineal_multiple](https://www.cienciadedatos.net/documentos/25_regresion_lineal_multiple.html#Introducci%C3%B3n)\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}