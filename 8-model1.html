<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.296">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Modelos lineales</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="8-model1_files/libs/clipboard/clipboard.min.js"></script>
<script src="8-model1_files/libs/quarto-html/quarto.js"></script>
<script src="8-model1_files/libs/quarto-html/popper.min.js"></script>
<script src="8-model1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="8-model1_files/libs/quarto-html/anchor.min.js"></script>
<link href="8-model1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="8-model1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="8-model1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="8-model1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="8-model1_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modelos lineales</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<ul>
<li>Modelo Lineal General - bases</li>
<li>Ajuste de Modelo</li>
<li>Verificación de supuestos</li>
<li>Performance del Modelo</li>
<li>Predicciones</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># usos generales</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  tidyverse, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  printr,    </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exploracion</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  GGally, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  correlation, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modelado </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  performance, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  relaimpo, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  see,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  car,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  sjPlot</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"select"</span>, <span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="modelos-lineares---generalidades" class="level2">
<h2 class="anchored" data-anchor-id="modelos-lineares---generalidades">Modelos lineares - generalidades</h2>
<section id="ml-simple-y-multiple" class="level3">
<h3 class="anchored" data-anchor-id="ml-simple-y-multiple">ML simple y multiple</h3>
<p>We kown that biological processes are complex by nature. They involve many variables and complex interactions. Although SLR models are useful in some scenarios, oftenly they fail at modeling this situations.</p>
<p>MLR allows us building <strong>more realistic</strong> and <strong>interpretable</strong> models. Although it has a number of applications, they fall into broad categories. For example, MLR is used as a tool for</p>
<ul>
<li><p><strong>Modeling</strong> crop yield response to fertilizer rates</p></li>
<li><p><strong>Predicting</strong> crop yields based on weather, soil, management variables</p></li>
<li><p>Identifying variables or factors that <strong>explain</strong> crop yields</p></li>
<li><p><strong>Controlling variation</strong> in designed experiments using quantiative covariables (ANCOVA)</p></li>
<li><p>Estimating soil properties from easy to measure soil variables and pedotransfer functions (<strong>variable substitution</strong>)</p></li>
</ul>
<p><span class="math display">\[\underbrace{Y}_{\substack{\text{random} \\ \text{variable}}} = f(X)=\underbrace{\beta_0 + \beta_1 X}_{\text{systematic}} + \underbrace{\varepsilon}_{\text{random}}\]</span></p>
<p>Simplest type of regression model used to relate a response variable Y, also called dependent variable, to a explanatory or independent variable X. Both variables were quantitative.</p>
<p>Although very simple, the model is very restrictive and could have high bias.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig_3/slr.png" class="quarto-discovered-preview-image img-fluid figure-img" width="400"></p>
</figure>
</div>
<p>This model has 2 parameters, the intercept and the slope, the first one represents the value of the response when the X is 0. The slope represents the change of Y for each unit change of X. If slope is 0, then there is no relation between X and Y.</p>
<p><strong>supuestos</strong></p>
<ul>
<li><p><span class="math inline">\(X\)</span> is <strong>fixed</strong> (Model 1) or <strong>random</strong> (model 2).</p></li>
<li><p><span class="math inline">\(Y\)</span> is <strong>random</strong> with <span class="math inline">\(E(Y|X)=\beta_0+\beta_1X\)</span></p></li>
<li><p>Errors are <strong>independent</strong> random variables with <strong>normal distribution</strong></p></li>
</ul>
<p><span class="math display">\[e_\text{iid} \sim N(0,\sigma^2_\varepsilon)\]</span> <span class="math display">\[\text{Cov}(e_i, e_j) = 0\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig_3/slr_assump.png" class="img-fluid figure-img" width="400"></p>
</figure>
</div>
<p>The straight line summarize the linear relationship between expectation of Y a each value of X. We also see that each observation is a realization from a random variable with normal distribution with expectation conditioned by X and constant variance</p>
<p>Well see that these assumptions are still valid for MLR</p>
</section>
<section id="estudio-de-caso-trigo-diploide" class="level3">
<h3 class="anchored" data-anchor-id="estudio-de-caso-trigo-diploide">Estudio de caso: trigo diploide</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig_3/Triticum_monococcum0.jpg" class="img-fluid figure-img" width="300"></p>
</figure>
</div>
<p>Several morphological traits were measured for 190 seeds selected at random from a line of diploid wheat (<em>Triticum monococcum</em>). <a href="http://www.wgin.org.uk/information/documents/WGIN%20publications%20pdfs/Jing%202007.pdf">(Jing et al., 2007)</a></p>
<p>The goal was to <em>identifying variables associated with differences in seed weight</em></p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">ID</th>
<th style="text-align: right;">weight</th>
<th style="text-align: right;">length</th>
<th style="text-align: right;">diameter</th>
<th style="text-align: right;">moisture</th>
<th style="text-align: right;">hardness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">30.15</td>
<td style="text-align: right;">3.27</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">10.27</td>
<td style="text-align: right;">-16.63</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">35.51</td>
<td style="text-align: right;">3.65</td>
<td style="text-align: right;">2.34</td>
<td style="text-align: right;">10.61</td>
<td style="text-align: right;">-8.27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">29.16</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">2.15</td>
<td style="text-align: right;">10.27</td>
<td style="text-align: right;">-21.45</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">16.82</td>
<td style="text-align: right;">2.77</td>
<td style="text-align: right;">1.79</td>
<td style="text-align: right;">11.05</td>
<td style="text-align: right;">4.13</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">23.42</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">1.80</td>
<td style="text-align: right;">10.02</td>
<td style="text-align: right;">-2.05</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">31.77</td>
<td style="text-align: right;">3.37</td>
<td style="text-align: right;">2.15</td>
<td style="text-align: right;">10.34</td>
<td style="text-align: right;">-41.78</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The variables measured were: <code>weight</code> (mg), <code>diameter</code> (mm), <code>length</code> (mm), <code>moisture</code> content (%), and endosperm <code>hardness</code> (single-kernel characterization system index value)</p>
</section>
</section>
<section id="exploracion" class="level2">
<h2 class="anchored" data-anchor-id="exploracion">Exploracion</h2>
<p>¿Are there any correlations between variables?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>triticum <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ID)  <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>() <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8-model1_files/figure-html/splom-1.png" class="img-fluid" style="width:80.0%"></p>
</div>
</div>
<p>si lo prefieren en modo tabla:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>triticum <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(length, diameter, moisture, hardness) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlation</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 17%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter1</th>
<th style="text-align: left;">Parameter2</th>
<th style="text-align: right;">r</th>
<th style="text-align: right;">CI</th>
<th style="text-align: right;">CI_low</th>
<th style="text-align: right;">CI_high</th>
<th style="text-align: right;">t</th>
<th style="text-align: right;">df_error</th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">Method</th>
<th style="text-align: right;">n_Obs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: left;">diameter</td>
<td style="text-align: right;">0.9990659</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.9987559</td>
<td style="text-align: right;">0.9992986</td>
<td style="text-align: right;">316.9951844</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: left;">Pearson correlation</td>
<td style="text-align: right;">190</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: left;">moisture</td>
<td style="text-align: right;">-0.0234600</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">-0.1652614</td>
<td style="text-align: right;">0.1192918</td>
<td style="text-align: right;">-0.3217553</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: left;">Pearson correlation</td>
<td style="text-align: right;">190</td>
</tr>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: left;">hardness</td>
<td style="text-align: right;">-0.1242600</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">-0.2619792</td>
<td style="text-align: right;">0.0184192</td>
<td style="text-align: right;">-1.7170749</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">0.4380616</td>
<td style="text-align: left;">Pearson correlation</td>
<td style="text-align: right;">190</td>
</tr>
<tr class="even">
<td style="text-align: left;">diameter</td>
<td style="text-align: left;">moisture</td>
<td style="text-align: right;">-0.0205691</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">-0.1624468</td>
<td style="text-align: right;">0.1221419</td>
<td style="text-align: right;">-0.2820887</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: left;">Pearson correlation</td>
<td style="text-align: right;">190</td>
</tr>
<tr class="odd">
<td style="text-align: left;">diameter</td>
<td style="text-align: left;">hardness</td>
<td style="text-align: right;">-0.1242389</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">-0.2619592</td>
<td style="text-align: right;">0.0184406</td>
<td style="text-align: right;">-1.7167784</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">0.4380616</td>
<td style="text-align: left;">Pearson correlation</td>
<td style="text-align: right;">190</td>
</tr>
<tr class="even">
<td style="text-align: left;">moisture</td>
<td style="text-align: left;">hardness</td>
<td style="text-align: right;">-0.1115795</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">-0.2499625</td>
<td style="text-align: right;">0.0312705</td>
<td style="text-align: right;">-1.5395141</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">0.4380616</td>
<td style="text-align: left;">Pearson correlation</td>
<td style="text-align: right;">190</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="ajuste-de-modelo" class="level2">
<h2 class="anchored" data-anchor-id="ajuste-de-modelo">Ajuste de modelo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  weight <span class="sc">~</span> length <span class="sc">+</span> diameter <span class="sc">+</span> hardness, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> triticum</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ length + diameter + hardness, data = triticum)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.0265 -1.9818  0.0038  2.1728  7.7197 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -31.95593    2.36468 -13.514  &lt; 2e-16 ***
length      -38.24789   14.62271  -2.616 0.009637 ** 
diameter     87.97672   23.29086   3.777 0.000213 ***
hardness     -0.04888    0.01622  -3.014 0.002935 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.774 on 186 degrees of freedom
Multiple R-squared:  0.8038,    Adjusted R-squared:  0.8006 
F-statistic:   254 on 3 and 186 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Then the summary() function provides the relevenat information for assesing the model as a whole and inspect the parameters</p>
<p>The fitted model:</p>
<p><span class="math display">\[\begin{align}
Y_\text{weight} &amp;= -31.95 + (-38.25) X_\text{length} + 87.98 X_\text{diameter}  + (-0.05)X_\text{hardness}
\end{align}\]</span></p>
<p><em>What these coefficients mean?</em></p>
<ul>
<li><p>They are <strong>partial slopes</strong>: effect of changing an <span class="math inline">\(X\)</span> but keeping the rest constant.</p></li>
<li><p>Unless standardized, they do not show their importance on the model.</p></li>
</ul>
<p>Example: <span class="math inline">\(X_\text{length} = -38.25\)</span> means that for each unit increase in length and holding the remaining predictors constant, the weight would decrease 40.15 units</p>
<ul>
<li>Estimating the error of the model</li>
</ul>
<p>Errors are the difference between observed <span class="math inline">\(y_i\)</span> and estimated or fitted values <span class="math inline">\(\hat y_i\)</span> :</p>
<p><span class="math display">\[\begin{align}
e_i &amp;= y_i - \hat{y}_i \\
&amp;= y_i - (\hat\beta_0 + \hat\beta_1x_{i1} + \hat\beta_2x_{i2} + \cdots + \hat\beta_px_{ip})
\end{align}\]</span></p>
<p>and the SSErr is:</p>
<p><span class="math display">\[\text{SSErr} = \sum{(y_i - \hat{y}_i)^2}\]</span></p>
<p>The <strong>mean squared error</strong> (MSErr) is:</p>
<p><span class="math display">\[\text{MSErr} = \dfrac{\text{SSErr}}{n-p-1} = \dfrac{\sum{(y_i - \hat{y}_i)^2}}{n-p-1}\]</span></p>
<p>Finally the estimate of the <strong>standard error of the model</strong>:</p>
<p><span class="math display">\[\hat\sigma_\varepsilon = \text{RMSE} = \sqrt{\dfrac{\text{SSErr}}{n-p-1}} = \sqrt{\dfrac{\sum{(y_i - \hat{y}_i)^2}}{n-p-1}}\]</span></p>
<p>We can get it form our model by using <code>sigma()</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.773872</code></pre>
</div>
</div>
<p><em>How to interpret this?</em></p>
<ul>
<li><p>The lower, the better.</p></li>
<li><p>It is the average deviation of a prediction from the observed values</p></li>
<li><p>Empirical rule: 95% of the prediction errors fall <span class="math inline">\(\pm\)</span> 2 RMSE</p></li>
<li><p>We can relate it to <span class="math inline">\(\bar{Y}\)</span></p></li>
</ul>
</section>
<section id="verificación-de-supuestos" class="level2">
<h2 class="anchored" data-anchor-id="verificación-de-supuestos">Verificación de supuestos</h2>
<p><a href="https://easystats.github.io/performance/articles/check_model.html">{performance}</a></p>
<div class="cell" data-out.heigth="100%">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8-model1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Looking at the residuals we can check if the model assumptions are supported</p>
<p>Inspecting what is left in the residuals can help us assess if the assumptions are met</p>
<p>¿Is there any pattern left in the residuals?</p>
<p>¿Are the errors normally distributed?</p>
<p>¿Are their variances constant?</p>
<p>¿Any leverage value?</p>
<ul>
<li>Multicollinearity</li>
</ul>
<p>It occurs when some degree of correlation between independent variables exists.</p>
<p><strong>Variance inflation ratio (VIF)</strong></p>
<p>How much variance of a coefficients is increased due to multicollinearity.</p>
<p><span class="math display">\[\text{VIF} = \dfrac{1}{1-R^2_j}\]</span> where: <span class="math inline">\(R^2_j\)</span> is the <span class="math inline">\(R^2\)</span> obtained from regressing <span class="math inline">\(X_j\)</span> against the rest of <span class="math inline">\(X\)</span>s</p>
<blockquote class="blockquote">
<p>Rule of thumb: VIF &gt; 10 might indicate serious multicollinearity.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(m1)   <span class="co"># from car package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As expected, <code>length</code> and <code>diameter</code> have huge VIF.</p>
<p>Need to drop one of them o decorrelate them (tip: multivariate approach?)</p>
</section>
<section id="assessing-the-model" class="level2">
<h2 class="anchored" data-anchor-id="assessing-the-model">Assessing the model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum Sq</th>
<th style="text-align: right;">Mean Sq</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5683.17526</td>
<td style="text-align: right;">5683.175256</td>
<td style="text-align: right;">738.615324</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">diameter</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">110.17237</td>
<td style="text-align: right;">110.172374</td>
<td style="text-align: right;">14.318581</td>
<td style="text-align: right;">0.0002080</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hardness</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">69.90966</td>
<td style="text-align: right;">69.909657</td>
<td style="text-align: right;">9.085826</td>
<td style="text-align: right;">0.0029354</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">1431.15173</td>
<td style="text-align: right;">7.694364</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Applying the sums of squares partition from simple linear regression model</p>
<p><span class="math display">\[\begin{array}{ccccc}
&amp; \text{SSTot} &amp; = &amp; \text{SSReg} &amp; + &amp; \text{SSErr} \\
&amp; \sum \left(y_i - \bar{y} \right)^2 &amp; = &amp; \sum \left(\hat{y}_i - \bar{y} \right)^2 &amp; + &amp; \sum \left(y_i - \hat{y}_i \right)^2 \\
\text{d.f.} &amp;n-1 &amp; = &amp; p &amp; + &amp; n-p-1
\end{array}\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fig_3/model_residuals.png" class="img-fluid figure-img" width="300"></p>
</figure>
</div>
<p><span class="math inline">\(\text{SSReg}\)</span> summarizes how much variability of <span class="math inline">\(Y\)</span> is captured by the model as a <strong>whole</strong> having the intercept and <span class="math inline">\(X_1,\dots,X_p\)</span> as predictors.</p>
<p>¿How much <span class="math inline">\(\text{SSReg}\)</span> is good enough?</p>
<p><span class="math inline">\(F_0 = \dfrac{\text{MSReg}}{\text{MSErr}} \sim F_{p;n-p-1}\)</span></p>
<p>Reject <span class="math inline">\(H_0\)</span> if: <span class="math inline">\(P(F_0 &gt; F) \le \alpha\)</span></p>
<p>Describe ANOVA, mention the overall hipotesis</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum Sq</th>
<th style="text-align: right;">Mean Sq</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">length</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5683.17526</td>
<td style="text-align: right;">5683.175256</td>
<td style="text-align: right;">738.615324</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">diameter</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">110.17237</td>
<td style="text-align: right;">110.172374</td>
<td style="text-align: right;">14.318581</td>
<td style="text-align: right;">0.0002080</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hardness</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">69.90966</td>
<td style="text-align: right;">69.909657</td>
<td style="text-align: right;">9.085826</td>
<td style="text-align: right;">0.0029354</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">1431.15173</td>
<td style="text-align: right;">7.694364</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Describe the output, the SSQ</p>
<ul>
<li><p>Enough evidence for rejecting <span class="math inline">\(H_0\)</span> (P &lt; 0.001) thus the overall regression model is statistically significant.</p></li>
<li><p>About 80% of the seed <code>weight</code> variability is explained by the model having <code>diameter</code>, <code>moistue</code>, and <code>hardness</code> as predictors</p></li>
</ul>
</section>
<section id="contribucion-de-variables-predictoras" class="level2">
<h2 class="anchored" data-anchor-id="contribucion-de-variables-predictoras">Contribucion de variables predictoras</h2>
<p><a href="https://rdrr.io/cran/relaimpo/man/calc.relimp.html">{relaimpo}</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ri_m <span class="ot">&lt;-</span> <span class="fu">calc.relimp</span>(m1, <span class="at">type =</span>  <span class="st">"car"</span>, <span class="at">rela =</span> <span class="cn">TRUE</span> )  </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ri_m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response variable: weight 
Total response variance: 38.59476 
Analysis based on 190 observations 

3 Regressors: 
length diameter hardness 
Proportion of variance explained by model: 80.38%
Metrics are normalized to sum to 100% (rela=TRUE). 

Relative importance metrics: 

                car
length   0.37367236
diameter 0.60075385
hardness 0.02557379</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ri_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8-model1_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="testing-parameters" class="level2">
<h2 class="anchored" data-anchor-id="testing-parameters">Testing parameters</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">t value</th>
<th style="text-align: right;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-31.9559282</td>
<td style="text-align: right;">2.3646825</td>
<td style="text-align: right;">-13.513835</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">length</td>
<td style="text-align: right;">-38.2478907</td>
<td style="text-align: right;">14.6227136</td>
<td style="text-align: right;">-2.615649</td>
<td style="text-align: right;">0.0096369</td>
</tr>
<tr class="odd">
<td style="text-align: left;">diameter</td>
<td style="text-align: right;">87.9767208</td>
<td style="text-align: right;">23.2908627</td>
<td style="text-align: right;">3.777306</td>
<td style="text-align: right;">0.0002132</td>
</tr>
<tr class="even">
<td style="text-align: left;">hardness</td>
<td style="text-align: right;">-0.0488784</td>
<td style="text-align: right;">0.0162157</td>
<td style="text-align: right;">-3.014270</td>
<td style="text-align: right;">0.0029354</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="reajustes-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="reajustes-del-modelo">Reajustes del modelo</h2>
<p>How to decide which variables to include?</p>
<ul>
<li><p>Context information about the problem</p></li>
<li><p>Exploratory analysis: correlations, scatterplots</p></li>
<li><p>Examining partial residuals (model mispecification)</p></li>
</ul>
<p>How to evaluate models?</p>
<ul>
<li><p>Don’t use <span class="math inline">\(R^2\)</span> as metric: the more predictors, the higher <span class="math inline">\(R^2\)</span>.</p></li>
<li><p>Use metrics that penalize for model complexity: AIC, BIC, Cp, Adj <span class="math inline">\(R^2\)</span></p></li>
<li><p>Training/test or cross-validation approaches</p></li>
</ul>
<p>There are automatic algorithms like <em>stepwise</em> for variable sepection:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">update</span>(m1, . <span class="sc">~</span> . <span class="sc">-</span>length)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">step</span>(m2, <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">upper =</span> <span class="sc">~</span> .<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=396.51
weight ~ diameter + hardness

                    Df Sum of Sq    RSS    AIC
+ diameter:hardness  1      23.4 1460.4 395.49
&lt;none&gt;                           1483.8 396.51
- hardness           1      69.5 1553.3 403.21
- diameter           1    5497.8 6981.6 688.76

Step:  AIC=395.49
weight ~ diameter + hardness + diameter:hardness

                    Df Sum of Sq    RSS    AIC
&lt;none&gt;                           1460.4 395.49
- diameter:hardness  1    23.436 1483.8 396.51</code></pre>
</div>
</div>
<p>After removing length to avoid colinearity with diameter, assuming diameter is easier to measure</p>
<p>We can run stepwise using step function which by default perform the procedure in both ways, forward and backwards. Optionally we can provide the scope limits. In this case, the first order interaction</p>
<p>In both direction algorithm each forward step is followed by a backwards selection to remove those terms that became not significant after addition. The step() function uses the AIC as criterion for comparing models.</p>
<p>In the example, it started by adding the interaction term and compared the new model with a model initial model (none) and a simpler model without hardeness + diameter.</p>
<p>After that it test the removal of this term. No further removal is tried because of the hierarchy principle: if an interaction is retained, also terms involved in the interaction must be present.</p>
<p>The summary of the model shows that the addition marginal improved the overall performance of the model (less residual standard error, higher R2)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">compare_performance</span>(m1, m2, m3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8-model1_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="modelo-final" class="level2">
<h2 class="anchored" data-anchor-id="modelo-final">Modelo final</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = weight ~ diameter + hardness, data = triticum)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.8364 -2.2099  0.1632  2.1060  8.3992 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -29.31312    2.17109  -13.50  &lt; 2e-16 ***
diameter     27.11379    1.03006   26.32  &lt; 2e-16 ***
hardness     -0.04874    0.01647   -2.96  0.00347 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.817 on 187 degrees of freedom
Multiple R-squared:  0.7966,    Adjusted R-squared:  0.7944 
F-statistic: 366.2 on 2 and 187 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum Sq</th>
<th style="text-align: right;">Mean Sq</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">diameter</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5741.09263</td>
<td style="text-align: right;">5741.092634</td>
<td style="text-align: right;">723.540177</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hardness</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">69.52273</td>
<td style="text-align: right;">69.522728</td>
<td style="text-align: right;">8.761832</td>
<td style="text-align: right;">0.0034743</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">187</td>
<td style="text-align: right;">1483.79365</td>
<td style="text-align: right;">7.934725</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><a href="https://strengejacke.github.io/sjPlot/index.html">{sjPlot}</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">weight</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-29.31</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-33.60&nbsp;–&nbsp;-25.03</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">diameter</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">27.11</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">25.08&nbsp;–&nbsp;29.15</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">hardness</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.05</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.08&nbsp;–&nbsp;-0.02</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.003</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">190</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.797 / 0.794</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="model-predictions" class="level2">
<h2 class="anchored" data-anchor-id="model-predictions">Model predictions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">check_predictions</span>(m2)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8-model1_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cuánto será el peso del grano si tengo diameter=2.5 y hardness=-1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">diameter =</span> <span class="fl">2.5</span>, <span class="at">hardness =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> new_data <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(m2, <span class="at">newdata =</span> new_data, <span class="at">interval =</span> <span class="st">"confidence"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">weight=</span>fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m2, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"diameter"</span>, <span class="st">"hardness"</span>))<span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>new_data, <span class="fu">aes</span>(<span class="at">x=</span>diameter, <span class="at">y=</span>weight), </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8-model1_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m2, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"hardness"</span>, <span class="st">"diameter"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="8-model1_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Se nota la mayor importancia de <code>diameter</code>en este grafico no?</p>
<p>Otra forma mas facil de usar el modelo…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpredict</span>(m2, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"diameter [2.5]"</span>, <span class="st">"hardness [-1]"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">x</th>
<th style="text-align: right;">predicted</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
<th style="text-align: left;">group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">38.5201</td>
<td style="text-align: right;">0.510608</td>
<td style="text-align: right;">37.51281</td>
<td style="text-align: right;">39.52739</td>
<td style="text-align: left;">-1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>